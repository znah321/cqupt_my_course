C51 COMPILER V8.05a   MAIN                                                                 07/26/2007 10:43:26 PAGE 1   


C51 COMPILER V8.05a, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE sources\main.c BROWSE INCDIR(.\include) DEBUG OBJECTEXTEND PRINT(.\main.lst
                    -) OBJECT(main.obj)

line level    source

   1          //********************************************************************************************************
             -*
   2          //********************************************************************************************************
             -*
   3          //***<程序名>：跑马灯                                                                                                                                                                   ***
   4          //***                                                                                                                                                                                                   ***
   5          //***<功能>：通过2个按钮实现8个LED灯以5种不同闪烁模式和4种速度的切换。                                                                  ***
   6          //***<芯片>：AT89C51                                                                                                                                                                    ***
   7          //***<作者>：程沛                                                                                                                                                                               ***
   8          //***<完成时间>：2007年7月25日。                                                                                                                                                ***
   9          //********************************************************************************************************
             -*
  10          //********************************************************************************************************
             -*
  11          
  12          
  13          //********************************************************************************************************
             -*
  14          //*                                                                                                                                                                                                               *
  15          //*                     ************************************头文件以及宏定义************************************          *
  16          //*                                                                                                                                                                                                               *
  17          //********************************************************************************************************
             -*
  18          
  19          #include<reg51.h>
  20          
  21          #define LEDPort P1
  22          
  23          //********************************************************************************************************
             -*
  24          //*                                                                                                                                                                                                               *
  25          //*                     ************************************全局变量定义************************************              *
  26          //*                                                                                                                                                                                                               *
  27          //********************************************************************************************************
             -*
  28          unsigned char aucLED_SELECT_01[9]=
  29                                          {0xFF,0xFE,0xFD,0xFB,0xF7,0xEF,0xDF,0xBF,0x7F,};
  30                                                                                                  //方式0，方式1灯开关数组。
  31          unsigned char aucLED_SELECT_23[5]=
  32                                          {0xFF,0x7E,0xBD,0xDB,0xE7};
  33                                                                                                  //方式2，方式3灯开关数组。
  34          
  35          unsigned char _i=0;                                                 //数据选择计数。
  36                                                                                                  
  37          unsigned char uc_Mode=0;                                        //模式选择，默认为模式0。
  38          
  39          unsigned char uc_Count=1;                                       //定时器中断计数。
  40          
  41          unsigned char uc_Delay=1;                                       //延迟计数，通过改变改数值改变灯状态延迟时间。
  42                                                                                                  //灯延迟时间=uc_Dalay*定时器溢出时间。
  43          
  44          
  45          
  46          //********************************************************************************************************
C51 COMPILER V8.05a   MAIN                                                                 07/26/2007 10:43:26 PAGE 2   

             -*
  47          //*                                                                                                                                                                                                               *
  48          //*                     ************************************主函数************************************                            *
  49          //*                                                                                                                                                                                                               *
  50          //********************************************************************************************************
             -*
  51          void main()
  52          {                                                                                                       
  53   1              TMOD=0x01;                                                              //定时器0模式一。
  54   1              TH0=0x3C;
  55   1              TL0=0xB0;                                                               //溢出时间：50ms。
  56   1              TR0=1;                                                                  //定时器0开启。
  57   1      
  58   1              IT0=1;                                                                  //外部中断0下降沿触发。
  59   1              IT1=1;                                                                  //外部中断1下降沿触发。
  60   1      
  61   1              EX0=1;                                                                  //外部中断0开。
  62   1              EX1=1;                                                                  //外部中断1开。
  63   1              ET0=1;                                                                  //定时器0中断开。
  64   1              EA=1;                                                                   //总中断开。
  65   1      
  66   1              while(1);
  67   1      }
  68          
  69          
  70          //********************************************************************************************************
             -*
  71          //*                                                                                                                                                                                                               *
  72          //*             ************************************定时器0中断函数************************************                   *
  73          //*                                                                                                                                                                                                               *
  74          //*<函数功能>：当定时器0溢出时执行此函数，首先执行2个判断：                                                                                               *
  75          //*                             （1）if判断是否改变灯的状态，可用于改变延时时间；                                                                                 *
  76          //*                             （2）switch判断闪烁模式，根据不同模式对灯进行不同的通断。                                                                 *
  77          //*                     最后对定时器TH0,TL0重新赋值，溢出时间为50ms。                                                                                             *
  78          //*                                                                                                                                                                                                               *
  79          //********************************************************************************************************
             -*
  80          
  81          void vTimer0(void) interrupt 1                      
  82          {
  83   1              
  84   1              if(uc_Count%uc_Delay==0)                          //通过此判断语句来改变延时。，例如：当uc_Delay=6时，定时器                                                                             
  85   1              {                                                                         //溢出5次时灯状态改变1次。同时uc_Count重新赋值1.否则，uc_Count++
  86   2                      uc_Count=1;                                               //等待下一次溢出。因此可以改变延时。
  87   2                      switch(uc_Mode)
  88   2                              {
  89   3       //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<模式0，灯从上往下依次点亮，不断循环。>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
             ->
  90   3                                      case 0:                                  
  91   3                                                      if(_i>=8)
  92   3                                                              _i=0;
  93   3                                                      else _i++;
  94   3                                                      LEDPort=aucLED_SELECT_01[_i];
  95   3                                                      break;
  96   3      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<模式1，灯从下往上依次点亮，不断循环。>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
             ->                
  97   3                                      case 1:                         
  98   3                                                      if(i<=0)
  99   3                                                              i=8;
 100   3                                                      else _i--;
 101   3      
 102   3                                                      LEDPort=aucLED_SELECT_01[_i];
C51 COMPILER V8.05a   MAIN                                                                 07/26/2007 10:43:26 PAGE 3   

 103   3                                                      break;
 104   3      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<模式2，灯从两边往中间依次点亮，不断循环。>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
             ->>
 105   3                                      case 2:                                  
 106   3                                                      if(_i>=4)
 107   3                                                              _i=0;
 108   3                                                      else _i++;
 109   3      
 110   3                                                      LEDPort=aucLED_SELECT_23[_i];
 111   3                                                      break;  
 112   3      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<模式3，灯从中间往两边依次点亮，不断循环。>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
             ->>
 113   3                                      case 3:                                  
 114   3                                                      if(_i<=0)
 115   3                                                              _i=4;
 116   3                                                      else _i--;
 117   3      
 118   3                                                      LEDPort=aucLED_SELECT_23[_i];
 119   3                                                      break;
 120   3      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<所有等以一定时间间隔同时闪烁。>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
             ->>
 121   3                                      case 4:                            
 122   3                                                      if(LEDPort==0xFF)
 123   3                                                              LEDPort=0x00;
 124   3                                                      else LEDPort=0xFF;
 125   3      //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<其他>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
             ->>
 126   3                                      default:
 127   3                                                      break;
 128   3                              }
 129   2                      }
 130   1                      else uc_Count++;
 131   1      
 132   1              TH0=0x3C;       //重新给定时器赋值。
 133   1              TL0=0xB0;       //定时时间：50ms。
 134   1      }
 135          
 136          
 137          
 138          
 139          
 140          //********************************************************************************************************
             -*
 141          //*                                                                                                                                                                                                               *
 142          //*             ************************************外部中断0中断函数************************************                 *
 143          //*                                                                                                                                                                                                               *
 144          //*     <函数功能>：当外部中断0产生下降沿信号时执行此函数，将闪灯模式从模式0到4循环切换。                                                 *
 145          //*                                                                                                                                                                                                               *
 146          //********************************************************************************************************
             -*
 147          
 148          void vModeChange(void) interrupt 0
 149          {
 150   1              if(uc_Mode>=4)
 151   1                      uc_Mode=0;
 152   1              else uc_Mode++;
 153   1      }
 154          
 155          
 156          
 157          
 158          
C51 COMPILER V8.05a   MAIN                                                                 07/26/2007 10:43:26 PAGE 4   

 159          //********************************************************************************************************
             -*
 160          //*                                                                                                                                                                                                               *
 161          //*             ************************************外部中断1中断函数************************************                 *
 162          //*                                                                                                                                                                                                               *
 163          //*<函数功能>：当外部中断1产生下降沿信号时执行此函数，将闪灯时间从50ms，250ms，500ms，750ms循环切换。             *
 164          //*                                                                                                                                                                                                               *
 165          //********************************************************************************************************
             -*
 166          
 167          void vDelayChange(void) interrupt 2
 168          {
 169   1              if(uc_Delay>=16)
 170   1                      uc_Delay=1;
 171   1              else uc_Delay+=5;
 172   1      }
 173          
 174          
 175          
 176          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    225    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
