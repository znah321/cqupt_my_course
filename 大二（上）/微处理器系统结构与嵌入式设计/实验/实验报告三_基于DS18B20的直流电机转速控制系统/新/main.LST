C51 COMPILER V9.57.0.0   MAIN                                                              12/22/2020 16:31:33 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\ÖÇÄÜ¿ØÖÆ1) DEBUG OBJECTEXTEND TAB
                    -S(2)

line level    source

   1          #include <reg52.h>
   2          #include <temp.h> 
   3          #include <i2c.h>
   4          #define LED P0
   5          void Int1Init();
   6          
   7          unsigned char timer1; //--¶¨ÒåÒ»¸öÈ«¾Ö±äÁ¿--//
   8          void Time1Config();
   9          sbit LED7=P2^7;
  10          sbit PWM=P1^0;
  11          sbit k4=P3^3;  //¶¨Òå°´¼üK4
  12          sbit LA = P2^2;
  13          sbit LB = P2^3;
  14          sbit LC = P2^4;
  15          uchar LED_CODE[12] = {0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x0,0x40}; // 0-9¡¢²»ÏÔÊ¾×Ö·û¡¢×Ö·
             -û"-"¶ÔÓ¦µÄ±àÂë
  16          uchar SEG_CODE[8][3] = {{1,1,1}, {1,1,0}, {1,0,1}, {1,0,0}, {0,1,1}, {0,1,0}, {0,0,1}, {0,0,0}}; // ¶ÎÂë
  17          uint DTemp[8] = {10, 10, 10, 10, 10, 10, 10, 1}; // LED¶¯Ì¬ÏÔÊ¾µÄÊý×Ö£¬Ç°4Î»ÎªÎÂ¶È£¬×îºóÒ»Î»±íÊ¾µµÎ»
  18          
  19          /*******************************************************************************
  20          * º¯ Êý Ãû         : delay
  21          * º¯Êý¹¦ÄÜ       : ÑÓÊ±º¯Êý£¬i=1Ê±£¬´óÔ¼ÑÓÊ±10us
  22          *******************************************************************************/
  23          void delay(uint i)
  24          {
  25   1        while(i--); 
  26   1      }
  27          
  28          void Time1Config()
  29          {
  30   1        TMOD= 0x10; //ÉèÖÃ¶¨Ê±¼ÆÊýÆ÷¹¤×÷·½Ê½1Îª¶¨Ê±Æ÷
  31   1        TH1 = 0xFE; //--¶¨Ê±Æ÷¸³³õÊ¼Öµ£¬12MHZÏÂ¶¨Ê±0.5ms--//
  32   1        TL1 = 0x0C;
  33   1        ET1 = 1; //¿ªÆô¶¨Ê±Æ÷1ÖÐ¶Ï
  34   1        EA = 1;
  35   1        PT1=0;
  36   1        TR1 = 1; //¿ªÆô¶¨Ê±Æ÷
  37   1      }
  38          int PWM_high=0;//¸ßµçÆ½³ÖÐøµÄÊ±¼ä
  39          int PWM_low=10;//µÍµçÆ½³ÖÐøµÄÊ±¼ä£¬10¸ö¶¨Ê±Æ÷Ê±¼ä5ms
  40          //µç»ú×ªËÙº¯Êý
  41          void Motor_speed(void)
  42          {
  43   1        if(timer1>(PWM_high+PWM_low))timer1=0;
  44   1        if(timer1<PWM_high)//Èç¹û¼ÆÊ±ÔÚ¸ßµçÆ½Ê±¼äÄÚ£¬ÔòPWMÊä³ö¸ßµçÆ½
  45   1        {
  46   2          PWM=1;
  47   2        }
  48   1        else //Èç¹ûÔÚµÍµçÆ½Ê±¼äÄÚ£¬ÔòPWMÊä³öµÍµçÆ½
  49   1        {
  50   2          PWM=0;
  51   2        }
  52   1      }
  53          void Time1(void) interrupt 3 //3 Îª¶¨Ê±Æ÷1µÄÖÐ¶ÏºÅ
C51 COMPILER V9.57.0.0   MAIN                                                              12/22/2020 16:31:33 PAGE 2   

  54          {
  55   1        TH1 = 0xFE; //ÖØÐÂ¸³³õÖµ
  56   1        TL1 = 0x0C;
  57   1        timer1++;
  58   1      }
  59          float temperature=0;
  60          /*******************************************************************************
  61          * º¯ Êý Ãû         : datapros()
  62          * º¯Êý¹¦ÄÜ       : ÎÂ¶È¶ÁÈ¡´¦Àí×ª»»º¯Êý
  63          * Êä    Èë         : temp
  64          * Êä    ³ö         : ÎÞ
  65          *******************************************************************************/
  66          void datapros(int temp)    
  67          {
  68   1          float tp, tp100;  
  69   1        if(temp< 0)       //µ±ÎÂ¶ÈÖµÎª¸ºÊý
  70   1          {
  71   2          //ÒòÎª¶ÁÈ¡µÄÎÂ¶ÈÊÇÊµ¼ÊÎÂ¶ÈµÄ²¹Âë£¬ËùÒÔ¼õ1£¬ÔÙÈ¡·´Çó³öÔ­Âë
  72   2          temp=temp-1;
  73   2          temp=~temp;
  74   2          tp=temp;
  75   2          temp=tp*0.0625*100+0.5; 
  76   2          tp=tp*0.0625; 
  77   2          //ÁôÁ½¸öÐ¡Êýµã¾Í*100£¬+0.5ÊÇËÄÉáÎåÈë£¬ÒòÎªCÓïÑÔ¸¡µãÊý×ª»»ÎªÕûÐÍµÄÊ±ºò°ÑÐ¡Êýµã
  78   2          //ºóÃæµÄÊý×Ô¶¯È¥µô£¬²»¹ÜÊÇ·ñ´óÓÚ0.5£¬¶ø+0.5Ö®ºó´óÓÚ0.5µÄ¾ÍÊÇ½ø1ÁË£¬Ð¡ÓÚ0.5µÄ¾Í
  79   2          //Ëã¼ÓÉÏ0.5£¬»¹ÊÇÔÚÐ¡ÊýµãºóÃæ¡£
  80   2          temperature=tp;
  81   2          }
  82   1        else
  83   1          {     
  84   2          tp=temp;//ÒòÎªÊý¾Ý´¦ÀíÓÐÐ¡ÊýµãËùÒÔ½«ÎÂ¶È¸³¸øÒ»¸ö¸¡µãÐÍ±äÁ¿
  85   2          //Èç¹ûÎÂ¶ÈÊÇÕýµÄÄÇÃ´£¬ÄÇÃ´ÕýÊýµÄÔ­Âë¾ÍÊÇ²¹ÂëËü±¾Éí
  86   2            temp=tp*0.0625*100+0.5;   
  87   2          tp=tp*0.0625;   
  88   2          //ÁôÁ½¸öÐ¡Êýµã¾Í*100£¬+0.5ÊÇËÄÉáÎåÈë£¬ÒòÎªCÓïÑÔ¸¡µãÊý×ª»»ÎªÕûÐÍµÄÊ±ºò°ÑÐ¡Êýµã
  89   2          //ºóÃæµÄÊý×Ô¶¯È¥µô£¬²»¹ÜÊÇ·ñ´óÓÚ0.5£¬¶ø+0.5Ö®ºó´óÓÚ0.5µÄ¾ÍÊÇ½ø1ÁË£¬Ð¡ÓÚ0.5µÄ¾Í
  90   2          //Ëã¼ÓÉÏ0.5£¬»¹ÊÇÔÚÐ¡ÊýµãºóÃæ¡£
  91   2          temperature=tp;
  92   2        }
  93   1          
  94   1        tp100 = temp % 10000 / 1000 *1000 + temp % 1000 / 100 * 100 +  temp % 100 / 10 * 10 + temp % 10 ;
  95   1        DTemp[0] = (int)tp100/1000;
  96   1        DTemp[1] = (int)tp100%1000/100;
  97   1        DTemp[2] = (int)tp100%100/10;
  98   1        DTemp[3] = (int)tp100%10;
  99   1      }
 100          //ÎÂ¶È¿ØÖÆµµÎ»
 101          void temp_select(void)
 102          {
 103   1        datapros(Ds18b20ReadTemp());   //Êý¾Ý´¦Àíº¯Êý
 104   1        if(temperature<20)
 105   1        {
 106   2          PWM_high=0;
 107   2          At24c02Write(1,PWM_high);//ÔÚµØÖ·1ÄÚÐ´ÈëÊý¾ÝPWM_high
 108   2        }
 109   1        if((temperature<26)&&(temperature>=20))
 110   1        {
 111   2          PWM_high=60;
 112   2          At24c02Write(1,PWM_high);//ÔÚµØÖ·1ÄÚÐ´ÈëÊý¾ÝPWM_high
 113   2        }
 114   1        if(temperature>=26)
 115   1        {
C51 COMPILER V9.57.0.0   MAIN                                                              12/22/2020 16:31:33 PAGE 3   

 116   2          PWM_high=52;
 117   2          At24c02Write(1,PWM_high);//ÔÚµØÖ·1ÄÚÐ´ÈëÊý¾ÝPWM_high
 118   2        }
 119   1      }
 120          
 121          int model=0;//modelÎª0±íÊ¾ÓÃºìÍâÒ£¿ØÑ¡Ôñ£¬1±íÊ¾×Ô¶¯,Ä¬ÈÏºìÍâÒ£¿Ø
 122          void DigDisplay()
 123          {
 124   1        uchar c;
 125   1        for(c = 0; c < 8; c++)
 126   1        {
 127   2          LC = SEG_CODE[c][0];LB = SEG_CODE[c][1];LA = SEG_CODE[c][2];
 128   2          if (c != 1)
 129   2            LED = LED_CODE[DTemp[c]];
 130   2          else
 131   2            LED = LED_CODE[DTemp[c]] | 0x80;
 132   2          delay(100);
 133   2          LED = 0x0;
 134   2        }
 135   1      }
 136          
 137          void Set_Gear()
 138          {
 139   1        switch(PWM_high)
 140   1        {
 141   2          case 0:DTemp[7] = 0;break;
 142   2          case 60:DTemp[7] = 1;break;
 143   2          case 52:DTemp[7] = 2;break;
 144   2        }
 145   1      }
 146          /*******************************************************************************
 147          * º¯ Êý Ãû       : main
 148          * º¯Êý¹¦ÄÜ     : Ö÷º¯Êý
 149          * Êä    Èë       : ÎÞ
 150          * Êä    ³ö       : ÎÞ
 151          *******************************************************************************/
 152          void main()
 153          { 
 154   1        Time1Config();
 155   1        Int1Init();
 156   1        Ds18b20Init();
 157   1        PWM_high=At24c02Read(1);    //¶ÁÈ¡EEPROMµØÖ·1ÄÚµÄÊý¾Ý±£´æÔÚPWM_highÖÐ
 158   1        while(1)
 159   1        {
 160   2          Set_Gear();
 161   2          DigDisplay();   
 162   2          Motor_speed();
 163   2          if(model==0)
 164   2          //model=0±íÊ¾£º×ªËÙÎ¬³Ö¶ÏµçÇ°µÄµµÎ»£¬²»¸ù¾ÝÎÂ¶È½øÐÐµ÷Õû£¬´ËÊ±LED7»áÁÁÆð
 165   2          {
 166   3            LED7=0;
 167   3          }
 168   2          else
 169   2          //model=1±íÊ¾£º¸ù¾ÝÎÂ¶Èµ÷ÕûµµÎ»£¬´ËÊ±LED7»áÏ¨Ãð
 170   2          {
 171   3            LED7=1;
 172   3            temp_select();
 173   3          }
 174   2        
 175   2        }
 176   1      }
 177          /*******************************************************************************
C51 COMPILER V9.57.0.0   MAIN                                                              12/22/2020 16:31:33 PAGE 4   

 178          * º¯ Êý Ãû         : Int1Init()
 179          * º¯Êý¹¦ÄÜ       : ÉèÖÃÍâ²¿ÖÐ¶Ï1
 180          * Êä    Èë         : ÎÞ
 181          * Êä    ³ö         : ÎÞ
 182          *******************************************************************************/
 183          void Int1Init()
 184          {
 185   1        //ÉèÖÃINT1
 186   1        IT1=1;//Ìø±äÑØ³ö·¢·½Ê½£¨ÏÂ½µÑØ£©
 187   1        EX1=1;//´ò¿ªINT1µÄÖÐ¶ÏÔÊÐí¡£  
 188   1        PX1=1;
 189   1        EA=1;//´ò¿ª×ÜÖÐ¶Ï 
 190   1      }
 191          /*******************************************************************************
 192          * º¯ Êý Ãû         : Int1() interrupt 2
 193          * º¯Êý¹¦ÄÜ       : Íâ²¿ÖÐ¶Ï0µÄÖÐ¶Ïº¯Êý
 194          * Êä    Èë         : ÎÞ
 195          * Êä    ³ö         : ÎÞ
 196          *******************************************************************************/
 197          
 198          void Int1() interrupt 2   //Íâ²¿ÖÐ¶Ï1µÄÖÐ¶Ïº¯Êý
 199          {
 200   1        delay(100);  //ÑÓÊ±Ïû¶¶
 201   1        if(k4==0)
 202   1        {
 203   2          model=!model;
 204   2        }
 205   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    793    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     63      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
